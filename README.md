
<!-- README.md is generated from README.Rmd. Please edit that file -->

# diffEnrich

The goal of diffEnrich is simple. Given a list of gene symbols,
*diffEnrich* will perform differential enrichment ananlysis using the
Kyoto Encyclopedia of Genes and Genomes (KEGG) REST API. This package
provides a number of functions that are intended to be used in a
pipeline (See Figure N). Breifly, the workflow will download and clean
species specific ENTREZ gene IDs and map them to their respective KEGG
pathways by accessing KEGG’s REST API. This way the user will always
have the most up-to-date pathway data from KEGG. Next, the user will
identify significantly enriched pathways from two different gene sets,
and finally, the user will identify pathways that are differentially
expressed between the two gene sets. In addition to the analysis
pipeline, this package also provides functions for data visualizations.

development of methods and software for differential enrichment analysis

Papers from Saba Lab where differentially enrichment has been used: 1.
[Shearn et al 2018 -
ACER](https://onlinelibrary.wiley.com/doi/full/10.1111/acer.13766)

## Installation

You can install the released version of diffEnrich from
[CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("diffEnrich")
```

## Example

### Step 1: Collect and clean pathways from KEGG API

First we will use the *get\_kegg* function access the KEGG REST API and
download the data sets required to perform our downstream analysis. This
function takes two arguments. The first, ‘species’ is required and is
the species of interest. Currently, *diffEnrich* supports three species,
and the argument is a character string using the KEGG code
[REF](https://www.pnas.org/content/suppl/2008/09/11/0806162105.DCSupplemental/ST1_PDF.pdf):
Homo sapiens (human), use ‘hsa’; Mus musculus (mouse), use ‘mmu’, and
Rattus norvegicus (rat), use ‘rno’. The second, ‘path’ is also passed as
a character string, and is the path of the directory in which the user
would like to write the data sets downloaded from the KEGG REST API. If
the user does not provide a path, the data sets will be automatically
written to the current working directory using the *here::here()*
functionality. These data sets will be tab delimited files with a name
describing the data, and for reproducibility, the date they were
generated and the version of KEGG when the API was accessed. In addition
to these flat files, *get\_kegg* will also create a named list with the
three relavent KEGG data sets. The names of this list will describe the
the data set.

``` r
suppressMessages(library(diffEnrich))

## run get_kegg() using rat
kegg_rno <- get_kegg('rno')
#> 3 data sets will be written as tab delimited text files
#> File location: /Users/smiharry/Documents/packages/diffEnrich
#> Kegg Release: Release_91.0+_07-01_Jul_19
```

Here are the files:

    kegg_to_pathway2019-04-26Release_90.0+_04-26_Apr_19.txt
    ncbi_to_kegg2019-04-26Release_90.0+_04-26_Apr_19.txt
    pathway_to_species2019-04-26Release_90.0+_04-26_Apr_19.txt

**Note:** Because it is assumed that the user might want to use the data
sets generated by *get\_kegg*, it is careful not to overwrite data sets
with exact names. *get\_kegg* checks the path provided for data sets
generated ‘same-day/same-version’, and if it finds even one of the
three, it will not re-write any of the data sets. It will still however,
let the user know it is not writing out new data sets and still generate
the named list object. Users can of course generate
‘same-day/same-version’ data sets in different directories if they so
choose.

``` r
## run get_kegg() using rat
kegg_rno <- get_kegg('rno')
#> These files already exist in your working directory. New files will not be generated.
#> Kegg Release: Release_91.0+_07-01_Jul_19
```

### Step 2: Perform individual enrichment analysis

In this step we will use the *pathEnrich* function to identify KEGG
pathways that are enriched (i.e. over-represented) based on a list of
genes we are interested in and based on a list of background genes. This
function may not always use the complete list of genes provided by the
user. Specifically, it will only use the genes from the list provided
that are also in the most current species list pulled from the KEGG REST
API using *get\_kegg*, or from the older KEGG data loaded by the user
from a previous *get\_kegg* call. The *pathEnrich* function should be
run at least twice, once for the genes of interest and once for the
background. Each *pathEnrich* call generates a dataframe summarizing the
results of an enrichment analysis in which a Fisher’s Exact test is used
to identify which KEGG pathways are enriched by the user’s list of
interesting genes with repect to background enrichment, and a p-value is
calculated using a hypergeometric distribution (Formula 1). P-values are
adjusted for multiple comparisons by controlling the False Discovery
Rate (FDR) at 0.05.

Formula 1:

  
![ P = 1-\\sum\_{i=0}^{k-1} \\frac{ \\binom{m} {i} \\binom{N-M} {n-i} }
{\\binom{N} {n} }
](https://latex.codecogs.com/png.latex?%20P%20%3D%201-%5Csum_%7Bi%3D0%7D%5E%7Bk-1%7D%20%5Cfrac%7B%20%5Cbinom%7Bm%7D%20%7Bi%7D%20%5Cbinom%7BN-M%7D%20%7Bn-i%7D%20%7D%20%7B%5Cbinom%7BN%7D%20%7Bn%7D%20%7D%20
" P = 1-\\sum_{i=0}^{k-1} \\frac{ \\binom{m} {i} \\binom{N-M} {n-i} } {\\binom{N} {n} } ")  

where N is the total number of genes in the background, M is the number
of genes within that background that also in the gene set of interest, n
is the size of the list of genes of interest and k is the number of
genes within that are in the background. The background by default is
all the genes that have annotation.

``` r
# run pathEnrich using kegg_rno
## Genes of interest
sig_pe <- pathEnrich(gk_obj = kegg, gene_list = geneLists$sigGenes)
## Background
bkg_pe <- pathEnrich(gk_obj = kegg, gene_list = geneLists$background)
knitr::kable(head(sig_pe),
             caption = "Table 1. Head of sig_pe dataframe generated using pathEnrich", row.names = FALSE) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = T)
```

| KEGG\_ID      | KEGG\_description                                        | KEGG\_cnt | KEGG\_in\_list | numTested | numSig | expected | enrich\_p |       fdr |
| :------------ | :------------------------------------------------------- | --------: | -------------: | --------: | -----: | -------: | --------: | --------: |
| path:rno04530 | Tight junction - Rattus norvegicus (rat)                 |       170 |             19 |      8834 |    293 | 5.638442 | 0.0000025 | 0.0008089 |
| path:rno05210 | Colorectal cancer - Rattus norvegicus (rat)              |        88 |             12 |      8834 |    293 | 2.918723 | 0.0000277 | 0.0045087 |
| path:rno04144 | Endocytosis - Rattus norvegicus (rat)                    |       275 |             22 |      8834 |    293 | 9.121010 | 0.0000739 | 0.0067965 |
| path:rno05231 | Choline metabolism in cancer - Rattus norvegicus (rat)   |        99 |             12 |      8834 |    293 | 3.283564 | 0.0000892 | 0.0067965 |
| path:rno05213 | Endometrial cancer - Rattus norvegicus (rat)             |        58 |              9 |      8834 |    293 | 1.923704 | 0.0001042 | 0.0067965 |
| path:rno04722 | Neurotrophin signaling pathway - Rattus norvegicus (rat) |       125 |             13 |      8834 |    293 | 4.145913 | 0.0002152 | 0.0116927 |

Table 1. Head of sig\_pe dataframe generated using pathEnrich

*pathEnrich* generates a dataframe with 9 columns described below.

<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">

<caption>

Table 2. Description of columns is dataframe generated by pathEnrich

</caption>

<thead>

<tr>

<th style="text-align:left;">

Column Names

</th>

<th style="text-align:left;">

Column Description

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

KEGG\_ID

</td>

<td style="text-align:left;">

KEGG ID

</td>

</tr>

<tr>

<td style="text-align:left;">

KEGG\_description

</td>

<td style="text-align:left;">

KEGG pathway description

</td>

</tr>

<tr>

<td style="text-align:left;">

KEGG\_cnt

</td>

<td style="text-align:left;">

PLACE HOLDER

</td>

</tr>

<tr>

<td style="text-align:left;">

KEGG\_in\_list

</td>

<td style="text-align:left;">

PLACE HOLDER

</td>

</tr>

<tr>

<td style="text-align:left;">

numTested

</td>

<td style="text-align:left;">

Total number of pathways in KEGG release

</td>

</tr>

<tr>

<td style="text-align:left;">

numSig

</td>

<td style="text-align:left;">

PLACE HOLDER

</td>

</tr>

<tr>

<td style="text-align:left;">

expected

</td>

<td style="text-align:left;">

PLACE HOLDER

</td>

</tr>

<tr>

<td style="text-align:left;">

enrich\_p

</td>

<td style="text-align:left;">

Unadjusted p-value from Fisher’s Exact test

</td>

</tr>

<tr>

<td style="text-align:left;">

fdr

</td>

<td style="text-align:left;">

False Discovery Rate (FDR)

</td>

</tr>

</tbody>

</table>

### Step 3: Identify differentially enriched KEGG pathways

The diffEnrich function will merge the results from the *pathEnrich*
calls generated above. Specifically, the dataframe ‘sig\_pe’ and the
dataframe ‘bkg\_pe’ will be merged using the base *merge* functionality
and be merged by the following columns: ‘c(“KEGG\_ID”,
“KEGG\_description”, “KEGG\_cnt”, “numTested”)’. This merged data set
will then be used to perform differential enrichment usng the same
method and p-value calculation as described above.

``` r
## Perform differential enrichment
diff_enrich <- diffEnrich(sig_pe = sig_pe, bkg_pe = bkg_pe)

knitr::kable(head(diff_enrich),
             caption = "Table 2. Description of columns is dataframe generated by pathEnrich", row.names = FALSE) %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">

<caption>

Table 2. Description of columns is dataframe generated by pathEnrich

</caption>

<thead>

<tr>

<th style="text-align:left;">

KEGG\_ID

</th>

<th style="text-align:left;">

KEGG\_description

</th>

<th style="text-align:right;">

KEGG\_cnt

</th>

<th style="text-align:right;">

numTested

</th>

<th style="text-align:right;">

KEGG\_in\_list\_sig

</th>

<th style="text-align:right;">

numSig\_sig

</th>

<th style="text-align:right;">

expected\_sig

</th>

<th style="text-align:right;">

enrich\_p\_sig

</th>

<th style="text-align:right;">

fdr\_sig

</th>

<th style="text-align:right;">

KEGG\_in\_list\_bkg

</th>

<th style="text-align:right;">

numSig\_bkg

</th>

<th style="text-align:right;">

expected\_bkg

</th>

<th style="text-align:right;">

enrich\_p\_bkg

</th>

<th style="text-align:right;">

fdr\_bkg

</th>

<th style="text-align:right;">

est

</th>

<th style="text-align:right;">

pv

</th>

</tr>

</thead>

<tbody>

<tr>

<td style="text-align:left;">

path:rno00010

</td>

<td style="text-align:left;">

Glycolysis / Gluconeogenesis - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

72

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

2.388046

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

46

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

43.13969

</td>

<td style="text-align:right;">

0.2584661

</td>

<td style="text-align:right;">

0.3253280

</td>

<td style="text-align:right;">

Inf

</td>

<td style="text-align:right;">

0.1735339

</td>

</tr>

<tr>

<td style="text-align:left;">

path:rno00020

</td>

<td style="text-align:left;">

Citrate cycle (TCA cycle) - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

33

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

2

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

1.094521

</td>

<td style="text-align:right;">

0.2980410

</td>

<td style="text-align:right;">

0.6362394

</td>

<td style="text-align:right;">

29

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

19.77236

</td>

<td style="text-align:right;">

0.0004131

</td>

<td style="text-align:right;">

0.0009160

</td>

<td style="text-align:right;">

0.8026996

</td>

<td style="text-align:right;">

0.6769666

</td>

</tr>

<tr>

<td style="text-align:left;">

path:rno00030

</td>

<td style="text-align:left;">

Pentose phosphate pathway - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

31

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

1.028187

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

21

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

18.57403

</td>

<td style="text-align:right;">

0.2346428

</td>

<td style="text-align:right;">

0.2999748

</td>

<td style="text-align:right;">

Inf

</td>

<td style="text-align:right;">

0.6242364

</td>

</tr>

<tr>

<td style="text-align:left;">

path:rno00040

</td>

<td style="text-align:left;">

Pentose and glucuronate interconversions - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

34

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

1

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

1.127689

</td>

<td style="text-align:right;">

0.6816199

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

16

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

20.37152

</td>

<td style="text-align:right;">

0.9521947

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

0.8857189

</td>

<td style="text-align:right;">

0.6005331

</td>

</tr>

<tr>

<td style="text-align:left;">

path:rno00051

</td>

<td style="text-align:left;">

Fructose and mannose metabolism - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

39

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

1

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

1.293525

</td>

<td style="text-align:right;">

0.7308383

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

29

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

23.36733

</td>

<td style="text-align:right;">

0.0407482

</td>

<td style="text-align:right;">

0.0595691

</td>

<td style="text-align:right;">

1.6052439

</td>

<td style="text-align:right;">

1.0000000

</td>

</tr>

<tr>

<td style="text-align:left;">

path:rno00052

</td>

<td style="text-align:left;">

Galactose metabolism - Rattus norvegicus (rat)

</td>

<td style="text-align:right;">

32

</td>

<td style="text-align:right;">

8834

</td>

<td style="text-align:right;">

0

</td>

<td style="text-align:right;">

293

</td>

<td style="text-align:right;">

1.061354

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

1.0000000

</td>

<td style="text-align:right;">

23

</td>

<td style="text-align:right;">

5293

</td>

<td style="text-align:right;">

19.17319

</td>

<td style="text-align:right;">

0.1085947

</td>

<td style="text-align:right;">

0.1481250

</td>

<td style="text-align:right;">

Inf

</td>

<td style="text-align:right;">

0.6303267

</td>

</tr>

</tbody>

</table>

The result of the *diffEnrich* call is the merged dataframe with the
estimated odds ration generated by the Fisher’s Exact test and the
associated p-value.
